<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taskly - Tasks</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        .task-card {
            transition: all 0.2s ease-in-out;
        }
        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
        }
        .task-completed {
            opacity: 0.6;
        }

        .fade-in {
            opacity: 0;
            transform: translateY(10px);
            animation: fadeInUp 0.5s ease-out forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="bg-[#1B2132] text-gray-100 font-sans">

<!-- Navbar -->
<nav class="bg-[#3B4A6B] px-6 py-4 flex justify-between items-center shadow-md sticky top-0 z-10">
    <a th:href="@{/home}" class="text-white text-xl font-bold flex items-center">
        <i class="fas fa-tasks mr-2 text-blue-400"></i> Taskly
    </a>
    <div class="text-gray-300 text-lg font-medium flex items-center">
        <span>Hi, <span th:text="${username}" class="font-semibold text-blue-400"></span></span>
        <form th:action="@{/logout}" method="post" class="ml-4 inline">
            <button type="submit" class="text-red-400 hover:text-red-500 text-base font-normal transition duration-150">
                <i class="fas fa-sign-out-alt mr-1"></i> Logout
            </button>
        </form>
    </div>
</nav>

<div class="flex" style="height: calc(100vh - 64px);">
    <!-- Sidebar -->
    <aside class="w-1/4 bg-[#232A3E] p-6 flex flex-col border-r border-[#3B4A6B] overflow-y-auto">
        <div class="flex-grow">
            <!-- Date Section -->
            <div class="mb-8 p-3 bg-[#3B4A6B] rounded-xl shadow-inner border border-gray-600">
                <h2 class="text-gray-400 text-sm uppercase font-semibold">Today's Date</h2>
                <p class="text-white text-2xl font-extrabold" id="currentDay"></p>
                <p class="text-blue-300 text-base font-medium" id="currentDate"></p>
            </div>

            <!-- Navigation -->
            <div class="mb-8">
                <h3 class="text-gray-300 font-semibold mb-3 border-b border-gray-600 pb-1 text-sm uppercase tracking-wider">Navigation</h3>
                <ul class="space-y-1">
                    <li class="p-2 rounded-lg"
                        th:classappend="${viewMode == 'Grouped' ? 'bg-blue-600/30 font-bold text-blue-300' : 'hover:bg-[#3B4A6B] text-gray-200'}">
                        <a th:href="@{/home}" class="flex items-center text-sm">
                            <i class="fas fa-home w-5 mr-3"></i> All Tasks (Home)
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Priority Filters -->
            <div class="mb-8">
                <h3 class="text-gray-300 font-semibold mb-3 border-b border-gray-600 pb-1 text-sm uppercase tracking-wider">Priority</h3>
                <ul class="space-y-1">
                    <li><a th:href="@{/home(priority='High')}" class="flex justify-between items-center p-2 rounded-lg hover:bg-[#3B4A6B]">
                        <span class="flex items-center text-sm"><i class="fas fa-exclamation-triangle text-red-500 mr-3"></i>High</span>
                        <span class="text-xs font-bold bg-red-600/70 px-2 py-0.5 rounded-full" th:text="${highPriorityCount}">0</span>
                    </a></li>
                    <li><a th:href="@{/home(priority='Medium')}" class="flex justify-between items-center p-2 rounded-lg hover:bg-[#3B4A6B]">
                        <span class="flex items-center text-sm"><i class="fas fa-exclamation-circle text-yellow-500 mr-3"></i>Medium</span>
                        <span class="text-xs font-bold bg-yellow-600/70 px-2 py-0.5 rounded-full" th:text="${mediumPriorityCount}">0</span>
                    </a></li>
                    <li><a th:href="@{/home(priority='Low')}" class="flex justify-between items-center p-2 rounded-lg hover:bg-[#3B4A6B]">
                        <span class="flex items-center text-sm"><i class="fas fa-info-circle text-green-500 mr-3"></i>Low</span>
                        <span class="text-xs font-bold bg-green-600/70 px-2 py-0.5 rounded-full" th:text="${lowPriorityCount}">0</span>
                    </a></li>
                </ul>
            </div>

            <!-- Category Filters -->
            <div>
                <h3 class="text-gray-300 font-semibold mb-3 border-b border-gray-600 pb-1 text-sm uppercase tracking-wider">Category</h3>
                <ul class="space-y-1">
                    <li><a th:href="@{/home(category='Work')}" class="flex justify-between items-center p-2 rounded-lg hover:bg-[#3B4A6B]">
                        <span class="flex items-center text-sm"><i class="fas fa-briefcase text-blue-300 mr-3"></i>Work</span>
                        <span class="text-xs font-bold bg-blue-700/70 px-2 py-0.5 rounded-full" th:text="${workCategoryCount}">0</span>
                    </a></li>
                    <li><a th:href="@{/home(category='Personal')}" class="flex justify-between items-center p-2 rounded-lg hover:bg-[#3B4A6B]">
                        <span class="flex items-center text-sm"><i class="fas fa-house-user text-pink-300 mr-3"></i>Personal</span>
                        <span class="text-xs font-bold bg-pink-700/70 px-2 py-0.5 rounded-full" th:text="${personalCategoryCount}">0</span>
                    </a></li>
                </ul>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8 overflow-y-auto">
        <div class="flex justify-between items-start mb-10">
            <a th:href="@{/tasks/add}" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition transform hover:scale-105 inline-flex items-center">
                <i class="fas fa-plus-circle mr-2"></i> Add New Task
            </a>
            <p id="dailyQuote" class="italic text-gray-400 text-sm"></p>
        </div>

        <div class="space-y-10 fade-in">
            <!-- ðŸ§± Grouped View -->
            <div th:if="${viewMode == 'Grouped'}" class="space-y-8">
                <!-- Overdue Tasks -->
                <section>
                    <h2 class="text-2xl font-bold border-b border-gray-700 pb-2 mb-4 flex items-center">
                        <i class="fas fa-exclamation-circle mr-2 text-red-500"></i> Overdue Tasks (Missed Deadlines)
                    </h2>
                    <div th:if="${overdueTasks.isEmpty()}" class="text-gray-400 italic p-4 text-center bg-[#232A3E] rounded-xl">
                        No missed tasks! Great job staying on track ðŸŽ¯
                    </div>
                    <div th:each="task : ${overdueTasks}">
                        <div th:replace="~{tasks :: taskCard(task=${task})}"></div>
                    </div>
                </section>

                <!-- Tasks Due Today -->
                <section>
                    <h2 class="text-2xl font-bold border-b border-gray-700 pb-2 mb-4">
                        <i class="fas fa-calendar-day mr-2 text-yellow-500"></i> Tasks Due Today (Previously Added)
                    </h2>
                    <div th:if="${tasksDueTodayOlder.isEmpty()}" class="text-gray-400 italic p-4 text-center bg-[#232A3E] rounded-xl">
                        Nothing previously added is due today! Take a break.
                    </div>
                    <div th:each="task : ${tasksDueTodayOlder}">
                        <div th:replace="~{tasks :: taskCard(task=${task})}"></div>
                    </div>
                </section>

                <!-- Today's Tasks -->
                <section>
                    <h2 class="text-2xl font-bold border-b border-gray-700 pb-2 mb-4">
                        <i class="fas fa-plus-square mr-2 text-cyan-500"></i> Today's Tasks (Added Today)
                    </h2>
                    <div th:if="${tasksAddedToday.isEmpty()}" class="text-gray-400 italic p-4 text-center bg-[#232A3E] rounded-xl">
                        No tasks added today yet. Time to plan!
                    </div>
                    <div th:each="task : ${tasksAddedToday}">
                        <div th:replace="~{tasks :: taskCard(task=${task})}"></div>
                    </div>
                </section>
            </div>

            <!-- ðŸ§± Filtered View -->
            <div th:if="${viewMode == 'Filtered'}">

                <h2 class="text-2xl font-bold border-b border-gray-700 pb-2 mb-4 flex items-center">
                    <i class="fas fa-filter mr-2 text-purple-400"></i>
                    <span class="text-gray-100">Filtered Tasks</span>

                    <!-- Dynamic filter text with matching color -->
                    <span th:if="${filterType}" class="ml-2 font-bold"
                          th:text="' : ' + ${filterType}"
                          th:classappend="${
              #strings.containsIgnoreCase(filterType, 'High') ? 'text-red-400' :
              (#strings.containsIgnoreCase(filterType, 'Medium') ? 'text-yellow-400' :
              (#strings.containsIgnoreCase(filterType, 'Low') ? 'text-green-400' :
              (#strings.containsIgnoreCase(filterType, 'Work') ? 'text-blue-400' :
              (#strings.containsIgnoreCase(filterType, 'Personal') ? 'text-pink-400' : 'text-gray-400'))))
          }">
    </span>
                </h2>


                <div th:if="${tasksFiltered.isEmpty()}" class="text-gray-400 italic p-4 text-center bg-[#232A3E] rounded-xl">
                    No tasks found matching this filter.
                </div>

                <div class="space-y-3">
                    <div th:each="task : ${tasksFiltered}">
                        <div th:replace="~{tasks :: taskCard(task=${task})}"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Task Card Fragment -->
<div th:fragment="taskCard(task)" th:if="${task != null}"
     class="task-card p-4 rounded-xl shadow-lg flex items-center justify-between border-l-4"
     th:classappend="${task.completed ? 'task-completed border-green-500 bg-gray-800' :
                   (task.priority == 'High' ? 'border-red-500 bg-[#3B4A6B]' :
                   (task.priority == 'Medium' ? 'border-yellow-500 bg-[#3B4A6B]' :
                   'border-blue-500 bg-[#3B4A6B]'))}">
    <div class="flex-1 mr-4 overflow-hidden">
        <h3 class="text-lg font-semibold truncate"
            th:classappend="${task.completed ? 'line-through text-gray-500' : 'text-white'}"
            th:text="${task.title}">Task Title</h3>

        <p class="text-sm text-white mt-1 truncate"
           th:text="${task.description}"
           th:if="${task.description != null and !task.description.isEmpty()}">Task description...</p>

        <div class="mt-2 flex flex-wrap gap-x-4 gap-y-1 text-xs items-center">
            <span th:if="${task.dueDate}" class="text-blue-400 flex items-center">
                <i class="fas fa-calendar-alt mr-1"></i>
                <span th:text="${#temporals.format(task.dueDate, 'dd MMM yyyy')}"></span>
            </span>

            <span th:if="${task.dueTime}" class="text-cyan-400 flex items-center">
                <i class="fas fa-clock mr-1"></i>
                <span th:text="${task.dueTime}"></span>
            </span>

            <span th:if="${task.priority}" class="font-medium px-2 py-0.5 rounded-full text-xs"
                  th:classappend="${task.priority == 'High' ? 'bg-red-900 text-red-300' :
                                (task.priority == 'Medium' ? 'bg-yellow-900 text-yellow-300' :
                                'bg-green-900 text-green-300')}"
                  th:text="${task.priority}"></span>

            <span th:if="${task.category}" class="flex items-center px-2 py-0.5 rounded-full text-xs"
                  th:classappend="${task.category == 'Work' ? 'bg-blue-900 text-blue-300' : 'bg-pink-900 text-pink-300'}">
                <i th:classappend="${task.category == 'Work' ? 'fas fa-briefcase' : 'fas fa-house-user'}" class="mr-1"></i>
                <span th:text="${task.category}"></span>
            </span>

            <span class="text-green-400 italic text-xs"
                  th:if="${task.createdOn != null}"
                  th:text="'Added: ' + ${#temporals.format(task.createdOn, 'dd MMM yy')}"></span>
        </div>
    </div>

    <div class="flex space-x-2 items-center">
        <form th:action="@{/tasks/toggle/{id}(id=${task.id})}" method="post">
            <button type="submit" class="p-2 w-8 h-8 rounded-full transition"
                    th:classappend="${task.completed ? 'bg-green-500 hover:bg-green-600' : 'bg-gray-600 hover:bg-green-500'}">
                <i class="fas fa-check text-white text-xs"></i>
            </button>
        </form>

        <a th:href="@{/tasks/edit/{id}(id=${task.id})}" class="bg-blue-600 hover:bg-blue-700 p-2 w-8 h-8 flex items-center justify-center rounded-full text-white transition">
            <i class="fas fa-pen text-xs"></i>
        </a>

        <form th:action="@{/tasks/delete/{id}(id=${task.id})}" method="post" onsubmit="return confirm('Are you sure you want to delete this task?');">
            <button type="submit" class="bg-red-600 hover:bg-red-700 p-2 w-8 h-8 flex items-center justify-center rounded-full text-white transition">
                <i class="fas fa-trash-alt text-xs"></i>
            </button>
        </form>
    </div>
</div>

<script th:src="@{/js/script.js?v=2}"></script>
</body>
</html>
